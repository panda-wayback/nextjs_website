# 测试环境安装指南

## 安装依赖

### 安装Jest和相关依赖
```bash
npm install --save-dev jest @types/jest ts-jest
```

### 安装Next.js测试工具
```bash
npm install --save-dev @testing-library/react @testing-library/jest-dom
```

## 配置文件

### 1. Jest配置文件（已创建）
`jest.config.js`

### 2. 在 package.json 中添加测试脚本
```json
{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage"
  }
}
```

## 运行测试

### 运行所有测试
```bash
npm test
```

### 运行特定测试文件
```bash
npm test route.test.ts
```

### 观察模式（自动运行测试）
```bash
npm run test:watch
```

### 生成测试覆盖率报告
```bash
npm run test:coverage
```

## 测试文件位置

所有测试文件位于：
```
app/api/strapi/activation-cards/__tests__/
├── route.test.ts
├── use-card-id.test.ts
├── use-card-by-code.test.ts
├── create-and-assign.test.ts
├── stats.test.ts
└── README.md
```

## 测试类型

### 1. 单元测试
测试单个API端点
- 创建激活卡
- 获取激活卡
- 更新激活卡
- 删除激活卡

### 2. 集成测试
测试API之间的协作
- 创建并分配激活卡
- 使用激活卡（完整流程）

### 3. 业务逻辑测试
测试权限控制和业务规则
- user_id权限控制
- 激活卡状态管理
- 过期检查

## 注意事项

1. 测试使用Node.js环境（不是浏览器环境）
2. 所有外部依赖都被mock
3. 每个测试应该独立运行
4. 使用描述性的测试名称
